<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÇözKazan Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, rgba(15, 12, 41, 0.95) 0%, rgba(48, 43, 99, 0.95) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 0 30px rgba(120, 119, 198, 0.3);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(120, 119, 198, 0.2);
        }

        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo h2 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 0 25px 25px 0;
            margin-right: 15px;
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            color: white;
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
            border-radius: 0 25px 25px 0;
            margin-right: 15px;
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px 35px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(120, 119, 198, 0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
        }

        .header-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px 25px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            border-radius: 15px;
            min-width: 120px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .stat-item:hover::before {
            left: 100%;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .card-icon {
            font-size: 24px;
            opacity: 0.8;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-change {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Table Styles */
        .table-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(120, 119, 198, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            font-weight: 600;
            font-size: 18px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Checkbox Styles */
        .test-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }

        #select-all {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }

        /* Bulk Delete Button */
        #bulk-delete-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        #bulk-delete-btn:hover {
            background: linear-gradient(135deg, #ee5a52, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .data-table th {
            color: #333;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer !important;
            pointer-events: auto !important;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            z-index: 1000;
            position: relative;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        /* Status Badges */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Hikaye Yönetimi Stilleri */
        .class-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(120, 119, 198, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .class-tab {
            padding: 18px 30px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: #333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .class-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .class-tab:hover::before {
            left: 100%;
        }

        .class-tab:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .class-tab.active {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            transform: translateY(-2px);
        }

        .class-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(120, 119, 198, 0.2);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .class-tab-content {
            display: none;
            padding: 30px;
        }

        .class-tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f8f9fa;
        }

        .class-header h3 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .class-stats {
            display: flex;
            gap: 15px;
        }

        .stat-badge {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }

        .stat-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .upload-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            border: 2px dashed rgba(255, 107, 107, 0.3);
            text-align: center;
            transition: all 0.4s ease;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-card:hover {
            border-color: #ff6b6b;
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.2);
        }

        .upload-card:hover::before {
            opacity: 1;
        }

        .upload-card h4 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upload-card p {
            color: #555;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.2);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .upload-subtext {
            font-size: 12px;
            color: #666;
        }

        .hikaye-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .list-header h4 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .modal-footer {
            padding: 20px 30px;
            background: #f8f9fa;
            border-radius: 0 0 20px 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .main-content {
                margin-left: 0;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .class-tabs {
                flex-direction: column;
            }
            .upload-section {
                grid-template-columns: 1fr;
            }
            .class-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        /* Test Management Styles */
        .test-management-container {
            padding: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-go {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-go:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .topic-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .topic-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            justify-content: center;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-excel {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-view {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        /* Test Kartları Stilleri */
        .test-list {
            margin-top: 30px;
        }

        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .test-info h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.3rem;
        }

        .test-info p {
            margin: 5px 0;
            color: #666;
            font-size: 0.95rem;
        }

        .test-actions {
            display: flex;
            gap: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .empty-state p {
            margin: 0;
            color: #666;
        }

        /* Özet Kartları Stilleri */
        .summary-cards-container {
            margin: 30px 0;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .summary-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .summary-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        /* Sınıf Sekmeleri Stilleri */
        .class-tabs-container {
            margin: 30px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .class-tabs {
            display: flex;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0;
            margin: 0;
        }

        .class-tab {
            flex: 1;
            background: none;
            border: none;
            color: white;
            padding: 15px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .class-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .class-tab.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 -3px 0 rgba(255, 255, 255, 0.5);
        }

        .class-content {
            padding: 30px;
        }

        .class-tab-content {
            display: none;
        }

        .class-tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .class-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .class-header h3 {
            color: #333;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .ders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .ders-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .ders-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .ders-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .ders-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .empty-state p {
            margin: 0;
            color: #666;
        }

        /* Test Yönetim Paneli Stilleri (test-yonetim.html'den) */
        .content {
            padding: 40px;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .filter-select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-go {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-go:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }

        .topic-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 180px;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-excel {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-view {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        /* Breadcrumb Navigasyon Stilleri (yonetim.html'den) */
        .breadcrumb-container {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .breadcrumb-container a, .breadcrumb-container span {
            font-size: 1.1rem;
            text-decoration: none;
            color: #3498db;
            transition: color 0.3s;
        }

        .breadcrumb-container a:hover {
            color: #2980b9;
        }

        .breadcrumb-container span {
            color: #7f8c8d;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 20px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .btn-custom {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-align: center;
        }

        .btn-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Renkler */
        .btn-sinif {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .btn-sinif::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-sinif:hover::before {
            left: 100%;
        }

        .btn-sinif:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn-sinif i {
            margin-right: 8px;
            font-size: 18px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .btn-ders { background-color: #2ecc71; }
        .btn-konu { background-color: #f39c12; }
        .btn-test { background-color: #e74c3c; }

        .breadcrumb-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        /* Genel Test Bölümü Stilleri */
        .general-test-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2><i class="fas fa-graduation-cap"></i> ÇözKazan</h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" onclick="showTab('dashboard', event)">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#test-yonetimi" class="nav-link" onclick="showTab('test-yonetimi', event)">
                        <i class="fas fa-clipboard-list"></i> Test Yönetimi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#kullanici-yonetimi" class="nav-link" onclick="showTab('kullanici-yonetimi', event)">
                        <i class="fas fa-users"></i> Kullanıcı Yönetimi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#hikaye-yonetimi" class="nav-link" onclick="showTab('hikaye-yonetimi', event)">
                        <i class="fas fa-book-open"></i> Hikaye Yönetimi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#sosyal-gorevler" class="nav-link" onclick="showTab('sosyal-gorevler', event)">
                        <i class="fas fa-tasks"></i> Sosyal Görevler
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#ai-ozellikleri" class="nav-link" onclick="showTab('ai-ozellikleri', event)">
                        <i class="fas fa-robot"></i> AI Özellikleri
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#gelisim-raporlari" class="nav-link" onclick="showTab('gelisim-raporlari', event)">
                        <i class="fas fa-chart-line"></i> Gelişim Raporları
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#odul-sistemi" class="nav-link" onclick="showTab('odul-sistemi', event)">
                        <i class="fas fa-trophy"></i> Ödül Sistemi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#sistem-ayarlari" class="nav-link" onclick="showTab('sistem-ayarlari', event)">
                        <i class="fas fa-cog"></i> Sistem Ayarları
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-number">1,234</div>
                        <div class="stat-label">Aktif Öğrenci</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">567</div>
                        <div class="stat-label">Toplam Test</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">89%</div>
                        <div class="stat-label">Başarı Oranı</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Toplam Öğrenci</div>
                            <div class="card-icon"><i class="fas fa-user-graduate"></i></div>
                        </div>
                        <div class="card-value">1,234</div>
                        <div class="card-change">+12% bu ay</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Çözülen Test</div>
                            <div class="card-icon"><i class="fas fa-clipboard-check"></i></div>
                        </div>
                        <div class="card-value">5,678</div>
                        <div class="card-change">+8% bu hafta</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Ortalama Başarı</div>
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                        </div>
                        <div class="card-value">89%</div>
                        <div class="card-change">+5% geçen aya göre</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Aktif Hikayeler</div>
                            <div class="card-icon"><i class="fas fa-book"></i></div>
                        </div>
                        <div class="card-value">45</div>
                        <div class="card-change">+3 yeni hikaye</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <i class="fas fa-clock"></i> Son Aktiviteler
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Öğrenci</th>
                                <th>Aktivite</th>
                                <th>Konu</th>
                                <th>Sonuç</th>
                                <th>Tarih</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Ahmet Yılmaz</td>
                                <td>Matematik Testi</td>
                                <td>Kesirler</td>
                                <td><span class="badge badge-success">95%</span></td>
                                <td>2 saat önce</td>
                            </tr>
                            <tr>
                                <td>Ayşe Demir</td>
                                <td>Hikaye Okuma</td>
                                <td>Macera</td>
                                <td><span class="badge badge-success">Tamamlandı</span></td>
                                <td>3 saat önce</td>
                            </tr>
                            <tr>
                                <td>Mehmet Kaya</td>
                                <td>Sosyal Görev</td>
                                <td>Yardımseverlik</td>
                                <td><span class="badge badge-warning">Devam Ediyor</span></td>
                                <td>5 saat önce</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Test Yönetimi Tab -->
            <div id="test-yonetimi" class="tab-content">
                <div class="test-management-container">
                    <!-- Üst İstatistikler (3 büyük kart) -->
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Aktif Öğrenci</div>
                                <div class="card-icon"><i class="fas fa-child"></i></div>
                            </div>
                            <div class="card-value">1,234</div>
                            <div class="card-change">Aktif: 1,156</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Toplam Test</div>
                                <div class="card-icon"><i class="fas fa-clipboard-list"></i></div>
                            </div>
                            <div class="card-value">567</div>
                            <div class="card-change">Aktif: 523</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Başarı Oranı</div>
                                <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                            </div>
                            <div class="card-value">89%</div>
                            <div class="card-change">Geçen aya göre +5%</div>
                        </div>
                    </div>

                    <!-- Orta Özet Kartları (5 küçük kart) -->
                    <div class="summary-cards-container">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <div class="summary-icon">📚</div>
                                <div class="summary-number" id="sinif-sayisi">4</div>
                                <div class="summary-label">Sınıf</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">📖</div>
                                <div class="summary-number" id="ders-sayisi">17</div>
                                <div class="summary-label">Ders</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">📝</div>
                                <div class="summary-number" id="konu-sayisi">111</div>
                                <div class="summary-label">Konu</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">✅</div>
                                <div class="summary-number" id="test-sayisi">6</div>
                                <div class="summary-label">Test</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">📖</div>
                                <div class="summary-number" id="hikaye-sayisi">15</div>
                                <div class="summary-label">Hikaye</div>
                            </div>
                        </div>
                    </div>

                    <!-- Breadcrumb Navigasyon -->
                    <div class="breadcrumb-container">
                        <a href="#" onclick="showBreadcrumbStep('ana')">Ana Sayfa</a>
                        <span>→</span>
                        <a href="#" onclick="showBreadcrumbStep('sinif')" id="breadcrumb-sinif">Sınıf Seçimi</a>
                        <span>→</span>
                        <a href="#" onclick="showBreadcrumbStep('ders')" id="breadcrumb-ders" style="display: none;">Ders Seçimi</a>
                        <span id="breadcrumb-ders-arrow" style="display: none;">→</span>
                        <a href="#" onclick="showBreadcrumbStep('konu')" id="breadcrumb-konu" style="display: none;">Konu Seçimi</a>
                        <span id="breadcrumb-konu-arrow" style="display: none;">→</span>
                        <a href="#" onclick="showBreadcrumbStep('test')" id="breadcrumb-test" style="display: none;">Test Yönetimi</a>
                    </div>

                    <!-- Sınıf Seçimi İçeriği (Ana Sayfa) -->
                    <div id="sinif-content" class="breadcrumb-content">
                        <div class="section-title">Sınıf Seçimi</div>
                        <div class="button-grid" id="sinif-buttons">
                            <!-- Sınıflar buraya yüklenecek -->
                        </div>
                    </div>

                    <!-- Ders Seçimi İçeriği -->
                    <div id="ders-content" class="breadcrumb-content" style="display: none;">
                        <div class="section-title">Ders Seçimi - <span id="selected-sinif">Sınıf</span></div>
                        <div class="button-grid" id="ders-buttons">
                            <!-- Dersler buraya yüklenecek -->
                        </div>
                    </div>

                    <!-- Konu Seçimi İçeriği -->
                    <div id="konu-content" class="breadcrumb-content" style="display: none;">
                        <div class="section-title">Konu Seçimi - <span id="selected-ders">Ders</span></div>
                        <div class="button-grid" id="konu-buttons">
                            <!-- Konular buraya yüklenecek -->
                        </div>
                    </div>

                    <!-- Test Yönetimi İçeriği -->
                    <div id="test-content" class="breadcrumb-content" style="display: none;">
                        <div class="section-title">Test Yönetimi - <span id="selected-konu">Konu</span></div>
                        <div class="test-list" id="test-list">
                            <div id="test-listesi"></div>
                        </div>
                    </div>

                    <!-- Genel Test Listesi (Tüm Testler) -->
                    <div class="general-test-section">
                        <div class="section-header">
                            <div class="section-title">Genel Test Listesi (Tüm Testler)</div>
                            <button id="bulk-delete-btn" class="btn btn-danger" onclick="bulkDeleteTests()" style="display: none;">
                                <i class="fas fa-trash"></i> Seçili Testleri Sil
                            </button>
                        </div>
                        <div class="test-list" id="general-test-list">
                            <div id="general-test-listesi"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kullanıcı Yönetimi Tab -->
            <div id="kullanici-yonetimi" class="tab-content">
                <h2><i class="fas fa-users"></i> Kullanıcı Yönetimi</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Toplam Öğrenci</div>
                            <div class="card-icon"><i class="fas fa-child"></i></div>
                        </div>
                        <div class="card-value">1,234</div>
                        <div class="card-change">Aktif: 1,156</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Toplam Veli</div>
                            <div class="card-icon"><i class="fas fa-user-friends"></i></div>
                        </div>
                        <div class="card-value">892</div>
                        <div class="card-change">Aktif: 845</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Yeni Kayıtlar</div>
                            <div class="card-icon"><i class="fas fa-user-plus"></i></div>
                        </div>
                        <div class="card-value">23</div>
                        <div class="card-change">Bu hafta</div>
                    </div>
                </div>
            </div>

            <!-- Hikaye Yönetimi Tab -->
            <div id="hikaye-yonetimi" class="tab-content">
                <h2><i class="fas fa-book-open"></i> Hikaye Yönetimi</h2>
                
                <!-- Sınıf Sekmeleri -->
                <div class="class-tabs">
                    <button class="class-tab active" onclick="showClassTab('sinif1')">
                        <i class="fas fa-child"></i> 1. Sınıf
                    </button>
                    <button class="class-tab" onclick="showClassTab('sinif2')">
                        <i class="fas fa-child"></i> 2. Sınıf
                    </button>
                    <button class="class-tab" onclick="showClassTab('sinif3')">
                        <i class="fas fa-child"></i> 3. Sınıf
                    </button>
                    <button class="class-tab" onclick="showClassTab('sinif4')">
                        <i class="fas fa-child"></i> 4. Sınıf
                    </button>
                </div>

                <!-- Sınıf İçerikleri -->
                <div class="class-content">
                    <!-- 1. Sınıf -->
                    <div id="sinif1-content" class="class-tab-content active">
                        <div class="class-header">
                            <h3><i class="fas fa-child"></i> 1. Sınıf Hikaye Havuzu</h3>
                            <div class="class-stats">
                                <span class="stat-badge">Toplam: <strong id="sinif1-total">0</strong></span>
                                <span class="stat-badge">Aktif: <strong id="sinif1-active">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="upload-section">
                            <div class="upload-card">
                                <h4><i class="fas fa-file-word"></i> Word Hikaye Yükle</h4>
                                <p>Word dosyasından hikaye yükleyin</p>
                                <div id="sinif1-word-upload-area" class="upload-area" onclick="selectWordFile('sinif1')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">Word dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .docx, .doc</div>
                                    </div>
                                    <input type="file" id="sinif1-word" accept=".docx,.doc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadWordHikaye('sinif1')" id="sinif1-word-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                            
                            <div class="upload-card">
                                <h4><i class="fas fa-file-pdf"></i> PDF Hikaye Yükle</h4>
                                <p>PDF dosyasından hikaye yükleyin</p>
                                <div id="sinif1-pdf-upload-area" class="upload-area" onclick="selectPdfFile('sinif1')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">PDF dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .pdf</div>
                                    </div>
                                    <input type="file" id="sinif1-pdf" accept=".pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadPdfHikaye('sinif1')" id="sinif1-pdf-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                        </div>

                        <div class="hikaye-list">
                            <div class="list-header">
                                <h4><i class="fas fa-list"></i> Hikaye Listesi</h4>

                            </div>
                            <div class="table-container">
                                <table class="data-table" id="sinif1-table">
                                    <thead>
                                        <tr>
                                            <th>Hikaye Adı</th>
                                            <th>Konu</th>
                                            <th>Seviye</th>
                                            <th>Okunma</th>
                                            <th>Durum</th>
                                            <th>İşlemler</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sinif1-table-body">
                                        <!-- Hikayeler buraya yüklenecek -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Sınıf -->
                    <div id="sinif2-content" class="class-tab-content">
                        <div class="class-header">
                            <h3><i class="fas fa-child"></i> 2. Sınıf Hikaye Havuzu</h3>
                            <div class="class-stats">
                                <span class="stat-badge">Toplam: <strong id="sinif2-total">0</strong></span>
                                <span class="stat-badge">Aktif: <strong id="sinif2-active">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="upload-section">
                            <div class="upload-card">
                                <h4><i class="fas fa-file-word"></i> Word Hikaye Yükle</h4>
                                <p>Word dosyasından hikaye yükleyin</p>
                                <div id="sinif2-word-upload-area" class="upload-area" onclick="selectWordFile('sinif2')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">Word dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .docx, .doc</div>
                                    </div>
                                    <input type="file" id="sinif2-word" accept=".docx,.doc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadWordHikaye('sinif2')" id="sinif2-word-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                            
                            <div class="upload-card">
                                <h4><i class="fas fa-file-pdf"></i> PDF Hikaye Yükle</h4>
                                <p>PDF dosyasından hikaye yükleyin</p>
                                <div id="sinif2-pdf-upload-area" class="upload-area" onclick="selectPdfFile('sinif2')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">PDF dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .pdf</div>
                                    </div>
                                    <input type="file" id="sinif2-pdf" accept=".pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadPdfHikaye('sinif2')" id="sinif2-pdf-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                        </div>

                        <div class="hikaye-list">
                            <div class="list-header">
                                <h4><i class="fas fa-list"></i> Hikaye Listesi</h4>

                            </div>
                            <div class="table-container">
                                <table class="data-table" id="sinif2-table">
                                    <thead>
                                        <tr>
                                            <th>Hikaye Adı</th>
                                            <th>Konu</th>
                                            <th>Seviye</th>
                                            <th>Okunma</th>
                                            <th>Durum</th>
                                            <th>İşlemler</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sinif2-table-body">
                                        <!-- Hikayeler buraya yüklenecek -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Sınıf -->
                    <div id="sinif3-content" class="class-tab-content">
                        <div class="class-header">
                            <h3><i class="fas fa-child"></i> 3. Sınıf Hikaye Havuzu</h3>
                            <div class="class-stats">
                                <span class="stat-badge">Toplam: <strong id="sinif3-total">0</strong></span>
                                <span class="stat-badge">Aktif: <strong id="sinif3-active">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="upload-section">
                            <div class="upload-card">
                                <h4><i class="fas fa-file-word"></i> Word Hikaye Yükle</h4>
                                <p>Word dosyasından hikaye yükleyin</p>
                                <div id="sinif3-word-upload-area" class="upload-area" onclick="selectWordFile('sinif3')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">Word dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .docx, .doc</div>
                                    </div>
                                    <input type="file" id="sinif3-word" accept=".docx,.doc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadWordHikaye('sinif3')" id="sinif3-word-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                            
                            <div class="upload-card">
                                <h4><i class="fas fa-file-pdf"></i> PDF Hikaye Yükle</h4>
                                <p>PDF dosyasından hikaye yükleyin</p>
                                <div id="sinif3-pdf-upload-area" class="upload-area" onclick="selectPdfFile('sinif3')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">PDF dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .pdf</div>
                                    </div>
                                    <input type="file" id="sinif3-pdf" accept=".pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadPdfHikaye('sinif3')" id="sinif3-pdf-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                        </div>

                        <div class="hikaye-list">
                            <div class="list-header">
                                <h4><i class="fas fa-list"></i> Hikaye Listesi</h4>

                            </div>
                            <div class="table-container">
                                <table class="data-table" id="sinif3-table">
                                    <thead>
                                        <tr>
                                            <th>Hikaye Adı</th>
                                            <th>Konu</th>
                                            <th>Seviye</th>
                                            <th>Okunma</th>
                                            <th>Durum</th>
                                            <th>İşlemler</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sinif3-table-body">
                                        <!-- Hikayeler buraya yüklenecek -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Sınıf -->
                    <div id="sinif4-content" class="class-tab-content">
                        <div class="class-header">
                            <h3><i class="fas fa-child"></i> 4. Sınıf Hikaye Havuzu</h3>
                            <div class="class-stats">
                                <span class="stat-badge">Toplam: <strong id="sinif4-total">0</strong></span>
                                <span class="stat-badge">Aktif: <strong id="sinif4-active">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="upload-section">
                            <div class="upload-card">
                                <h4><i class="fas fa-file-word"></i> Word Hikaye Yükle</h4>
                                <p>Word dosyasından hikaye yükleyin</p>
                                <div id="sinif4-word-upload-area" class="upload-area" onclick="selectWordFile('sinif4')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">Word dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .docx, .doc</div>
                                    </div>
                                    <input type="file" id="sinif4-word" accept=".docx,.doc" style="display: none;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadWordHikaye('sinif4')" id="sinif4-word-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                            
                            <div class="upload-card">
                                <h4><i class="fas fa-file-pdf"></i> PDF Hikaye Yükle</h4>
                                <p>PDF dosyasından hikaye yükleyin</p>
                                <div id="sinif4-pdf-upload-area" class="upload-area" onclick="selectPdfFile('sinif4')">
                                    <div class="upload-area-content">
                                        <div class="upload-icon">📄</div>
                                        <div class="upload-text">PDF dosyasını buraya sürükleyin veya seçmek için tıklayın</div>
                                        <div class="upload-subtext">Desteklenen formatlar: .pdf</div>
                                    </div>
                                    <input type="file" id="sinif4-pdf" accept=".pdf" style="display: none;">
                                </div>
                                <button class="btn btn-primary" onclick="uploadPdfHikaye('sinif4')" id="sinif4-pdf-upload" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Yükle
                                </button>

                            </div>
                        </div>

                        <div class="hikaye-list">
                            <div class="list-header">
                                <h4><i class="fas fa-list"></i> Hikaye Listesi</h4>

                            </div>
                            <div class="table-container">
                                <table class="data-table" id="sinif4-table">
                                    <thead>
                                        <tr>
                                            <th>Hikaye Adı</th>
                                            <th>Konu</th>
                                            <th>Seviye</th>
                                            <th>Okunma</th>
                                            <th>Durum</th>
                                            <th>İşlemler</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sinif4-table-body">
                                        <!-- Hikayeler buraya yüklenecek -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sosyal Görevler Tab -->
            <div id="sosyal-gorevler" class="tab-content">
                <h2><i class="fas fa-tasks"></i> Sosyal Görevler</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Aktif Görevler</div>
                            <div class="card-icon"><i class="fas fa-clipboard-list"></i></div>
                        </div>
                        <div class="card-value">12</div>
                        <div class="card-change">Tamamlanan: 8</div>
                    </div>
                </div>
            </div>

            <!-- AI Özellikleri Tab -->
            <div id="ai-ozellikleri" class="tab-content">
                <h2><i class="fas fa-robot"></i> AI Özellikleri</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">AI Sohbetler</div>
                            <div class="card-icon"><i class="fas fa-comments"></i></div>
                        </div>
                        <div class="card-value">1,234</div>
                        <div class="card-change">Bu hafta</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">AI Analizler</div>
                            <div class="card-icon"><i class="fas fa-brain"></i></div>
                        </div>
                        <div class="card-value">567</div>
                        <div class="card-change">Bu ay</div>
                    </div>
                </div>
            </div>

            <!-- Gelişim Raporları Tab -->
            <div id="gelisim-raporlari" class="tab-content">
                <h2><i class="fas fa-chart-line"></i> Gelişim Raporları</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Ortalama Gelişim</div>
                            <div class="card-icon"><i class="fas fa-trending-up"></i></div>
                        </div>
                        <div class="card-value">+15%</div>
                        <div class="card-change">Geçen aya göre</div>
                    </div>
                </div>
            </div>

            <!-- Ödül Sistemi Tab -->
            <div id="odul-sistemi" class="tab-content">
                <h2><i class="fas fa-trophy"></i> Ödül Sistemi</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Verilen Ödüller</div>
                            <div class="card-icon"><i class="fas fa-medal"></i></div>
                        </div>
                        <div class="card-value">234</div>
                        <div class="card-change">Bu hafta</div>
                    </div>
                </div>
            </div>

            <!-- Sistem Ayarları Tab -->
            <div id="sistem-ayarlari" class="tab-content">
                <h2><i class="fas fa-cog"></i> Sistem Ayarları</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Sistem Durumu</div>
                            <div class="card-icon"><i class="fas fa-server"></i></div>
                        </div>
                        <div class="card-value">Aktif</div>
                        <div class="card-change">Uptime: 99.9%</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Veritabanı</div>
                            <div class="card-icon"><i class="fas fa-database"></i></div>
                        </div>
                        <div class="card-value">Bağlı</div>
                        <div class="card-change">MongoDB</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hikaye Düzenleme Modal -->
    <div id="hikayeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Hikaye Düzenle</h3>
                <span class="close" onclick="closeHikayeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="hikayeForm">
                    <input type="hidden" id="hikayeId">
                    <div class="form-group">
                        <label for="hikayeBaslik">Hikaye Başlığı:</label>
                        <input type="text" id="hikayeBaslik" required>
                    </div>
                    <div class="form-group">
                        <label for="hikayeKonu">Konu:</label>
                        <input type="text" id="hikayeKonu" required>
                    </div>
                    <div class="form-group">
                        <label for="hikayeSeviye">Seviye:</label>
                        <select id="hikayeSeviye" required>
                            <option value="Kolay">Kolay</option>
                            <option value="Orta">Orta</option>
                            <option value="Zor">Zor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hikayeIcerik">İçerik:</label>
                        <textarea id="hikayeIcerik" rows="6" placeholder="Hikaye içeriğini buraya yazın..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hikayeAktif"> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveHikaye()">
                    <i class="fas fa-save"></i> Kaydet
                </button>
                <button class="btn btn-danger" onclick="deleteHikayeFromModal()">
                    <i class="fas fa-trash"></i> Sil
                </button>
                <button class="btn btn-secondary" onclick="closeHikayeModal()">
                    <i class="fas fa-times"></i> İptal
                </button>
            </div>
        </div>
    </div>

    <!-- Hikaye Düzenleme Modal -->
    <div id="hikayeModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Hikaye Düzenle</h3>
                <span class="close" onclick="closeHikayeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="hikayeEditForm">
                    <input type="hidden" id="hikayeId" name="hikayeId">
                    
                    <div class="form-group">
                        <label for="hikayeTitle">Hikaye Başlığı:</label>
                        <input type="text" id="hikayeTitle" name="title" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="hikayeTopic">Konu:</label>
                        <input type="text" id="hikayeTopic" name="topic" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="hikayeLevel">Seviye:</label>
                        <select id="hikayeLevel" name="level" class="form-control" required>
                            <option value="kolay">Kolay</option>
                            <option value="orta">Orta</option>
                            <option value="zor">Zor</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hikayeContent">Hikaye İçeriği:</label>
                        <textarea id="hikayeContent" name="content" class="form-control" rows="15" required 
                                  placeholder="Hikaye içeriğini buraya yazın. Sarı çizgili soru kısımlarını silmek için o bölümleri kaldırın."></textarea>
                        <small class="form-text text-muted">
                            💡 <strong>Soru kısımlarını silmek için:</strong> Sarı çizgi içindeki metinleri seçip silin.
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="hikayeActive">Durum:</label>
                        <select id="hikayeActive" name="active" class="form-control">
                            <option value="true">Aktif</option>
                            <option value="false">Pasif</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeHikayeModal()">
                    <i class="fas fa-times"></i> İptal
                </button>
                <button type="button" class="btn btn-danger" onclick="deleteHikayeFromModal()">
                    <i class="fas fa-trash"></i> Sil
                </button>
                <button type="button" class="btn btn-primary" onclick="saveHikayeChanges()">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <script>
        // Tab değiştirme fonksiyonu
        function showTab(tabName, event) {
            // Tüm tabları gizle
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Tüm nav linklerini pasif yap
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));

            // Seçilen tabı göster
            document.getElementById(tabName).classList.add('active');

            // Seçilen nav linkini aktif yap (event varsa)
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Sayfa başlığını güncelle
            const pageTitle = document.getElementById('page-title');
            const titles = {
                'dashboard': 'Dashboard',
                'test-yonetimi': 'Test Yönetimi',
                'kullanici-yonetimi': 'Kullanıcı Yönetimi',
                'hikaye-yonetimi': 'Hikaye Yönetimi',
                'sosyal-gorevler': 'Sosyal Görevler',
                'ai-ozellikleri': 'AI Özellikleri',
                'gelisim-raporlari': 'Gelişim Raporları',
                'odul-sistemi': 'Ödül Sistemi',
                'sistem-ayarlari': 'Sistem Ayarları'
            };
            pageTitle.textContent = titles[tabName];

            // Test yönetimi tabında sınıf seçimi ana sayfa olsun
            if (tabName === 'test-yonetimi') {
                showBreadcrumbStep('sinif');
                updateSummaryCards();
                loadGeneralTestList();
            }
            
            // Hikaye yönetimi tabında file input'ları ayarla
            if (tabName === 'hikaye-yonetimi') {
                setTimeout(() => {
                    setupFileInputs();
                    loadHikayeListesi();
                }, 100);
            }
        }

        // Testleri yükle
        async function loadTests() {
            try {
                // Firebase'den tüm testleri al
                const testlerSnapshot = await db.collection('testler').get();
                
                const tableBody = document.getElementById('test-table-body');
                tableBody.innerHTML = '';

                testlerSnapshot.forEach(doc => {
                    const test = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="test-checkbox" value="${doc.id}" onchange="updateBulkDeleteButton()">
                        </td>
                        <td>${test.ad || test.testAdi || 'İsimsiz Test'}</td>
                        <td>${test.konu || 'Belirtilmemiş'}</td>
                        <td>${test.soruSayisi || 0}</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editTest('${doc.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTest('${doc.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Testler yüklenirken hata:', error);
                alert('Testler yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Test düzenle
        function editTest(testId) {
            window.location.href = `/test-duzenle.html?id=${testId}`;
        }

        // Test sil
        async function deleteTest(testId) {
            if (confirm('Bu testi silmek istediğinizden emin misiniz?')) {
                try {
                    await db.collection('testler').doc(testId).delete();
                    loadTests();
                    alert('Test başarıyla silindi!');
                } catch (error) {
                    console.error('Test silinirken hata:', error);
                    alert('Test silinirken hata oluştu: ' + error.message);
                }
            }
        }

        // Tümünü seç/kaldır
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all');
            const testCheckboxes = document.querySelectorAll('.test-checkbox');
            
            testCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateBulkDeleteButton();
        }

        // Toplu silme butonunu güncelle
        function updateBulkDeleteButton() {
            const checkedBoxes = document.querySelectorAll('.test-checkbox:checked');
            const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
            
            if (checkedBoxes.length > 0) {
                bulkDeleteBtn.style.display = 'inline-block';
                bulkDeleteBtn.innerHTML = `<i class="fas fa-trash"></i> Seçilenleri Sil (${checkedBoxes.length})`;
            } else {
                bulkDeleteBtn.style.display = 'none';
            }
        }

        // Toplu silme işlemi
        async function bulkDeleteTests() {
            const checkedBoxes = document.querySelectorAll('.test-checkbox:checked');
            const testIds = Array.from(checkedBoxes).map(checkbox => checkbox.value);
            
            if (testIds.length === 0) {
                alert('Lütfen silinecek testleri seçin!');
                return;
            }
            
            const confirmMessage = `${testIds.length} testi silmek istediğinizden emin misiniz?\n\nBu işlem geri alınamaz!`;
            
            if (confirm(confirmMessage)) {
                try {
                    let successCount = 0;
                    let errorCount = 0;
                    
                    for (const testId of testIds) {
                        try {
                            await db.collection('testler').doc(testId).delete();
                            successCount++;
                        } catch (error) {
                            errorCount++;
                            console.error(`Test ${testId} silinirken hata:`, error);
                        }
                    }
                    
                    // Sonuçları göster
                    let message = '';
                    if (successCount > 0) {
                        message += `${successCount} test başarıyla silindi.`;
                    }
                    if (errorCount > 0) {
                        message += `\n${errorCount} test silinirken hata oluştu.`;
                    }
                    
                    alert(message);
                    
                    // Tabloyu yenile
                    loadTests();
                    
                } catch (error) {
                    console.error('Toplu silme işleminde hata:', error);
                    alert('Toplu silme işleminde bir hata oluştu!');
                }
            }
        }

        // Test fonksiyonları
        function testWordSelect() {
            console.log('testWordSelect çağrıldı');
            const fileInput = document.getElementById('sinif1-word');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                try {
                    // File input'u görünür yap
                    fileInput.style.opacity = '1';
                    fileInput.style.pointerEvents = 'auto';
                    fileInput.style.position = 'relative';
                    fileInput.style.zIndex = '1000';
                    
                    console.log('File input görünür yapıldı');
                    fileInput.click();
                    console.log('File input click() çağrıldı');
                    
                    // Tekrar gizle
                    setTimeout(() => {
                        fileInput.style.opacity = '0';
                        fileInput.style.pointerEvents = 'none';
                        fileInput.style.position = 'absolute';
                        fileInput.style.zIndex = '-1';
                    }, 100);
                } catch (error) {
                    console.error('File input click hatası:', error);
                    alert('Dosya seçici açılamadı: ' + error.message);
                }
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testWordSelect2() {
            console.log('testWordSelect2 çağrıldı');
            const fileInput = document.getElementById('sinif2-word');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testWordSelect3() {
            console.log('testWordSelect3 çağrıldı');
            const fileInput = document.getElementById('sinif3-word');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testWordSelect4() {
            console.log('testWordSelect4 çağrıldı');
            const fileInput = document.getElementById('sinif4-word');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testPdfSelect() {
            console.log('testPdfSelect çağrıldı');
            const fileInput = document.getElementById('sinif1-pdf');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testPdfSelect2() {
            console.log('testPdfSelect2 çağrıldı');
            const fileInput = document.getElementById('sinif2-pdf');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testPdfSelect3() {
            console.log('testPdfSelect3 çağrıldı');
            const fileInput = document.getElementById('sinif3-pdf');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        function testPdfSelect4() {
            console.log('testPdfSelect4 çağrıldı');
            const fileInput = document.getElementById('sinif4-pdf');
            console.log('File input bulundu:', fileInput);
            if (fileInput) {
                fileInput.click();
                console.log('File input click() çağrıldı');
            } else {
                alert('File input bulunamadı!');
            }
        }

        // Sayfa yüklendiğinde dashboard'u göster
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event tetiklendi');
            showTab('dashboard');
            
            // File input event listener'larını ekle
            setupFileInputs();
        });

        // Hikaye Yönetimi Fonksiyonları
        function showClassTab(className) {
            console.log('showClassTab çağrıldı:', className);
            
            // Tüm sınıf tablarını gizle
            const classTabs = document.querySelectorAll('.class-tab-content');
            classTabs.forEach(tab => tab.classList.remove('active'));

            // Tüm sınıf butonlarını pasif yap
            const classButtons = document.querySelectorAll('.class-tab');
            classButtons.forEach(btn => btn.classList.remove('active'));

            // Seçilen sınıfı göster
            document.getElementById(className + '-content').classList.add('active');

            // Seçilen butonu aktif yap
            event.target.classList.add('active');

            // File input'ları yeniden ayarla
            setupFileInputs();

            // Hikayeleri yükle
            loadHikayeler(className);
        }

        // Dosya seçim fonksiyonları
        function selectWordFile(sinif) {
            const fileInput = document.getElementById(sinif + '-word');
            const uploadBtn = document.getElementById(sinif + '-word-upload');
            
            fileInput.click();
            
            fileInput.onchange = function() {
                console.log('Word dosyası seçildi:', this.files[0]?.name);
                if (this.files.length > 0) {
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Yükle (' + this.files[0].name + ')';
                } else {
                    uploadBtn.disabled = true;
                    uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Yükle';
                }
            };
        }

        function selectPdfFile(sinif) {
            const fileInput = document.getElementById(sinif + '-pdf');
            const uploadBtn = document.getElementById(sinif + '-pdf-upload');
            
            fileInput.click();
            
            fileInput.onchange = function() {
                console.log('PDF dosyası seçildi:', this.files[0]?.name);
                if (this.files.length > 0) {
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Yükle (' + this.files[0].name + ')';
                } else {
                    uploadBtn.disabled = true;
                    uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Yükle';
                }
            };
        }

        // File input'ları ayarla - Basit versiyon
        function setupFileInputs() {
            console.log('setupFileInputs çağrıldı');
            // Artık gerekli değil, selectWordFile ve selectPdfFile kullanıyoruz
        }

        // Word hikaye yükle
        async function uploadWordHikaye(sinif) {
            console.log('uploadWordHikaye çağrıldı:', sinif);
            
            const fileInput = document.getElementById(sinif + '-word');
            const uploadBtn = document.getElementById(sinif + '-word-upload');
            
            console.log('File input:', fileInput);
            console.log('Upload btn:', uploadBtn);
            console.log('Files:', fileInput?.files);
            
            if (!fileInput || !fileInput.files.length) {
                console.log('Dosya seçilmedi');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('sinif', sinif);

            console.log('FormData oluşturuldu:', formData);

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Yükleniyor...';

            try {
                console.log('API çağrısı yapılıyor...');
                const response = await fetch('/api/hikaye/word-upload', {
                    method: 'POST',
                    body: formData
                });

                console.log('Response:', response);

                if (response.ok) {
                    const result = await response.json();
                    console.log('Başarılı sonuç:', result);
                    loadHikayeler(sinif);
                } else {
                    const error = await response.json();
                    console.error('API hatası:', error);
                    alert('Hata: ' + error.message);
                }
            } catch (error) {
                console.error('Word yükleme hatası:', error);
                alert('Word yüklenirken bir hata oluştu!');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Yükle';
                fileInput.value = '';
            }
        }

        // PDF hikaye yükle
        async function uploadPdfHikaye(sinif) {
            const fileInput = document.getElementById(sinif + '-pdf');
            const uploadBtn = document.getElementById(sinif + '-pdf-upload');
            
            if (!fileInput.files.length) {
                console.log('PDF dosyası seçilmedi');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('sinif', sinif);

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Yükleniyor...';

            try {
                const response = await fetch('/api/hikaye/pdf-upload', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('PDF başarıyla yüklendi:', result);
                    loadHikayeler(sinif);
                } else {
                    const error = await response.json();
                    console.error('PDF yükleme hatası:', error);
                    alert('Hata: ' + error.message);
                }
            } catch (error) {
                console.error('PDF yükleme hatası:', error);
                alert('PDF yüklenirken bir hata oluştu!');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Yükle';
                fileInput.value = '';
            }
        }

        // Hikayeleri yükle
        async function loadHikayeler(sinif) {
            try {
                const response = await fetch(`/api/hikaye/${sinif}`);
                const hikayeler = await response.json();
                
                const tableBody = document.getElementById(sinif + '-table-body');
                const totalSpan = document.getElementById(sinif + '-total');
                const activeSpan = document.getElementById(sinif + '-active');
                
                tableBody.innerHTML = '';
                
                let total = 0;
                let active = 0;

                hikayeler.forEach(hikaye => {
                    total++;
                    if (hikaye.aktif) active++;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${hikaye.baslik}</td>
                        <td>${hikaye.konu}</td>
                        <td>${hikaye.seviye}</td>
                        <td>${hikaye.okunmaSayisi || 0}</td>
                        <td>
                            <span class="badge ${hikaye.aktif ? 'badge-success' : 'badge-warning'}">
                                ${hikaye.aktif ? 'Aktif' : 'Pasif'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editHikaye('${hikaye._id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${hikaye.dosyaTipi === 'pdf' ? `
                            <button class="btn btn-info btn-sm" onclick="extractPdfContent('${hikaye._id}', '${sinif}')" title="PDF İçeriğini Çıkar">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            ` : ''}
                            <button class="btn btn-danger btn-sm" onclick="deleteHikaye('${hikaye._id}', '${sinif}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-success btn-sm" onclick="toggleHikayeStatus('${hikaye._id}', '${sinif}')">
                                <i class="fas ${hikaye.aktif ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                totalSpan.textContent = total;
                activeSpan.textContent = active;
                
            } catch (error) {
                console.error('Hikayeler yüklenirken hata:', error);
            }
        }

        // Yeni hikaye ekle
        function addNewHikaye(sinif) {
            const baslik = prompt('Hikaye başlığını girin:');
            if (!baslik) return;
            
            const konu = prompt('Hikaye konusunu girin:');
            if (!konu) return;
            
            const seviye = prompt('Hikaye seviyesini girin (Kolay/Orta/Zor):');
            if (!seviye) return;

            const hikayeData = {
                baslik: baslik,
                konu: konu,
                seviye: seviye,
                sinif: sinif,
                aktif: true
            };

            fetch('/api/hikaye', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(hikayeData)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Hikaye başarıyla eklendi!');
                    loadHikayeler(sinif);
                } else {
                    alert('Hata: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Hikaye ekleme hatası:', error);
                alert('Hikaye eklenirken bir hata oluştu!');
            });
        }

        // Hikaye düzenleme modal'ını aç
        async function editHikaye(hikayeId) {
            try {
                const response = await fetch(`/api/hikaye/id/${hikayeId}`);
                const hikaye = await response.json();
                
                if (hikaye) {
                    document.getElementById('hikayeId').value = hikaye._id;
                    document.getElementById('hikayeBaslik').value = hikaye.baslik;
                    document.getElementById('hikayeKonu').value = hikaye.konu;
                    document.getElementById('hikayeSeviye').value = hikaye.seviye;
                    document.getElementById('hikayeIcerik').value = hikaye.icerik || '';
                    document.getElementById('hikayeAktif').checked = hikaye.aktif;
                    
                    document.getElementById('hikayeModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Hikaye yükleme hatası:', error);
                alert('Hikaye yüklenirken bir hata oluştu!');
            }
        }

        // Modal'ı kapat
        function closeHikayeModal() {
            document.getElementById('hikayeModal').style.display = 'none';
            document.getElementById('hikayeForm').reset();
        }

        // Hikaye kaydet
        async function saveHikaye() {
            const hikayeId = document.getElementById('hikayeId').value;
            const hikayeData = {
                baslik: document.getElementById('hikayeBaslik').value,
                konu: document.getElementById('hikayeKonu').value,
                seviye: document.getElementById('hikayeSeviye').value,
                icerik: document.getElementById('hikayeIcerik').value,
                aktif: document.getElementById('hikayeAktif').checked
            };

            try {
                const response = await fetch(`/api/hikaye/${hikayeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hikayeData)
                });

                if (response.ok) {
                    alert('Hikaye başarıyla güncellendi!');
                    closeHikayeModal();
                    // Aktif sınıfı yeniden yükle
                    const activeClass = document.querySelector('.class-tab-content.active').id.replace('-content', '');
                    loadHikayeler(activeClass);
                } else {
                    const error = await response.json();
                    alert('Hata: ' + error.message);
                }
            } catch (error) {
                console.error('Hikaye güncelleme hatası:', error);
                alert('Hikaye güncellenirken bir hata oluştu!');
            }
        }

        // Modal'dan hikaye sil
        async function deleteHikayeFromModal() {
            const hikayeId = document.getElementById('hikayeId').value;
            
            if (confirm('Bu hikayeyi silmek istediğinizden emin misiniz?')) {
                try {
                    const response = await fetch(`/api/hikaye/${hikayeId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Hikaye başarıyla silindi!');
                        closeHikayeModal();
                        // Aktif sınıfı yeniden yükle
                        const activeClass = document.querySelector('.class-tab-content.active').id.replace('-content', '');
                        loadHikayeler(activeClass);
                    } else {
                        const error = await response.json();
                        alert('Hata: ' + error.message);
                    }
                } catch (error) {
                    console.error('Hikaye silme hatası:', error);
                    alert('Hikaye silinirken bir hata oluştu!');
                }
            }
        }

        // Hikaye sil
        async function deleteHikaye(hikayeId, sinif) {
            if (confirm('Bu hikayeyi silmek istediğinizden emin misiniz?')) {
                try {
                    const response = await fetch(`/api/hikaye/${hikayeId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Hikaye başarıyla silindi!');
                        loadHikayeler(sinif);
                    } else {
                        const error = await response.json();
                        alert('Hata: ' + error.message);
                    }
                } catch (error) {
                    console.error('Hikaye silme hatası:', error);
                    alert('Hikaye silinirken bir hata oluştu!');
                }
            }
        }

        // Hikaye durumunu değiştir
        async function toggleHikayeStatus(hikayeId, sinif) {
            try {
                const response = await fetch(`/api/hikaye/${hikayeId}/toggle`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    alert('Hikaye durumu başarıyla değiştirildi!');
                    loadHikayeler(sinif);
                } else {
                    const error = await response.json();
                    alert('Hata: ' + error.message);
                }
            } catch (error) {
                console.error('Hikaye durum değiştirme hatası:', error);
                alert('Hikaye durumu değiştirilirken bir hata oluştu!');
            }
        }

        // Hikaye düzenleme fonksiyonları
        function editHikaye(hikayeId, sinif) {
            console.log('Hikaye düzenleme açılıyor:', hikayeId);
            
            // Hikaye verilerini getir
            fetch(`/api/hikaye/id/${hikayeId}`)
                .then(response => response.json())
                .then(hikaye => {
                    document.getElementById('hikayeId').value = hikaye._id;
                    document.getElementById('hikayeTitle').value = hikaye.baslik;
                    document.getElementById('hikayeTopic').value = hikaye.konu;
                    document.getElementById('hikayeLevel').value = hikaye.seviye;
                    document.getElementById('hikayeContent').value = hikaye.icerik;
                    document.getElementById('hikayeActive').value = hikaye.aktif.toString();
                    
                    // Modal'ı aç
                    document.getElementById('hikayeModal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Hikaye getirme hatası:', error);
                    alert('Hikaye bilgileri alınırken hata oluştu!');
                });
        }

        function closeHikayeModal() {
            document.getElementById('hikayeModal').style.display = 'none';
        }

        async function saveHikayeChanges() {
            const hikayeId = document.getElementById('hikayeId').value;
            const formData = {
                baslik: document.getElementById('hikayeTitle').value,
                konu: document.getElementById('hikayeTopic').value,
                seviye: document.getElementById('hikayeLevel').value,
                icerik: document.getElementById('hikayeContent').value,
                aktif: document.getElementById('hikayeActive').value === 'true'
            };

            try {
                const response = await fetch(`/api/hikaye/${hikayeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('Hikaye başarıyla güncellendi!');
                    closeHikayeModal();
                    // Aktif sınıfı yeniden yükle
                    const activeClass = document.querySelector('.class-tab-content.active').id.replace('-content', '');
                    loadHikayeler(activeClass);
                } else {
                    const error = await response.json();
                    alert('Hata: ' + error.message);
                }
            } catch (error) {
                console.error('Hikaye güncelleme hatası:', error);
                alert('Hikaye güncellenirken bir hata oluştu!');
            }
        }

        // PDF içeriğini çıkar
        async function extractPdfContent(hikayeId, sinif) {
            if (confirm('PDF içeriğini çıkarmak istediğinizden emin misiniz? Bu işlem biraz zaman alabilir.')) {
                try {
                    const response = await fetch(`/api/hikaye/pdf-extract/${hikayeId}`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert('PDF içeriği başarıyla çıkarıldı! Şimdi düzenleyebilirsiniz.');
                        loadHikayeler(sinif);
                    } else {
                        const error = await response.json();
                        alert('Hata: ' + error.message);
                    }
                } catch (error) {
                    console.error('PDF içeriği çıkarma hatası:', error);
                    alert('PDF içeriği çıkarılırken bir hata oluştu!');
                }
            }
        }

        // Test fonksiyonları
        function testWordClick(sinif) {
            console.log('testWordClick çağrıldı:', sinif);
            const fileInput = document.getElementById(sinif + '-word');
            if (fileInput) {
                console.log('Word file input bulundu, click() çağrılıyor...');
                fileInput.click();
            } else {
                console.error('Word file input bulunamadı:', sinif + '-word');
                alert('Word file input bulunamadı!');
            }
        }

        function testPdfClick(sinif) {
            console.log('testPdfClick çağrıldı:', sinif);
            const fileInput = document.getElementById(sinif + '-pdf');
            if (fileInput) {
                console.log('PDF file input bulundu, click() çağrılıyor...');
                fileInput.click();
            } else {
                console.error('PDF file input bulunamadı:', sinif + '-pdf');
                alert('PDF file input bulunamadı!');
            }
        }

        async function loadHikayeListesi() {
          try {
            const response = await fetch('/api/hikaye');
            const hikayeler = await response.json();
            const tableBody = document.getElementById('sinif1-table-body') || document.getElementById('hikaye-table-body') || document.querySelector('tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            hikayeler.forEach(hikaye => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${hikaye.baslik || hikaye.title || ''}</td>
                <td>${hikaye.konu || ''}</td>
                <td>${hikaye.seviye || ''}</td>
                <td>${hikaye.okunma || 0}</td>
                <td>${hikaye.aktif ? 'Aktif' : 'Pasif'}</td>
                <td>...</td>
              `;
              tableBody.appendChild(row);
            });
          } catch (err) {
            console.error('Hikaye listesi yüklenemedi:', err);
          }
        }

        // Firebase yapılandırması
        const firebaseConfig = {
            apiKey: "AIzaSyC4lhsmEH8OQWlkUfSR0a3jvY0_EHiXEiA",
            authDomain: "cozkazan-app.firebaseapp.com",
            projectId: "cozkazan-app",
            storageBucket: "cozkazan-app.firebasestorage.app",
            messagingSenderId: "846053857270",
            appId: "1:846053857270:web:d2ba3637824325d5e519d7",
            measurementId: "G-DZ0NNZHW7S"
        };

        // Firebase'i başlat
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Firebase'den verileri yükle
        async function loadDataFromFirebase() {
            try {
                // Sınıfları yükle
                const siniflarSnapshot = await db.collection('siniflar').get();
                const siniflar = [];
                siniflarSnapshot.forEach(doc => {
                    siniflar.push({ id: doc.id, ...doc.data() });
                });

                // Dersleri yükle
                const derslerSnapshot = await db.collection('dersler').get();
                const dersler = [];
                derslerSnapshot.forEach(doc => {
                    dersler.push({ id: doc.id, ...doc.data() });
                });

                // Konuları yükle
                const konularSnapshot = await db.collection('konular').get();
                const konular = [];
                konularSnapshot.forEach(doc => {
                    konular.push({ id: doc.id, ...doc.data() });
                });

                // Testleri yükle
                const testlerSnapshot = await db.collection('testler').get();
                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({ id: doc.id, ...doc.data() });
                });

                // Hikayeleri yükle
                const hikayelerSnapshot = await db.collection('hikayeler').get();
                const hikayeler = [];
                hikayelerSnapshot.forEach(doc => {
                    hikayeler.push({ id: doc.id, ...doc.data() });
                });

                console.log('Firebase\'den yüklenen veriler:', {
                    siniflar: siniflar.length,
                    dersler: dersler.length,
                    konular: konular.length,
                    testler: testler.length,
                    hikayeler: hikayeler.length
                });

                // İstatistikleri güncelle
                updateStatistics(siniflar.length, dersler.length, konular.length, testler.length, hikayeler.length);

            } catch (error) {
                console.error('Firebase\'den veri yükleme hatası:', error);
            }
        }

        // İstatistikleri güncelle
        function updateStatistics(sinifSayisi, dersSayisi, konuSayisi, testSayisi, hikayeSayisi) {
            const statsContainer = document.querySelector('.stats-container');
            if (statsContainer) {
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-icon">📚</div>
                        <div class="stat-number">${sinifSayisi}</div>
                        <div class="stat-label">Sınıf</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📖</div>
                        <div class="stat-number">${dersSayisi}</div>
                        <div class="stat-label">Ders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📝</div>
                        <div class="stat-number">${konuSayisi}</div>
                        <div class="stat-label">Konu</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-number">${testSayisi}</div>
                        <div class="stat-label">Test</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📖</div>
                        <div class="stat-number">${hikayeSayisi}</div>
                        <div class="stat-label">Hikaye</div>
                    </div>
                `;
            }
        }

        // Sayfa yüklendiğinde Firebase'den verileri yükle
        document.addEventListener('DOMContentLoaded', loadDataFromFirebase);

        // Filtreleme fonksiyonları
        async function loadSiniflar() {
            try {
                const siniflarSnapshot = await db.collection('siniflar').get();
                
                const sinifFilter = document.getElementById('sinif-filter');
                sinifFilter.innerHTML = '<option value="">Sınıf Seçin</option>';
                siniflarSnapshot.forEach(doc => {
                    const sinif = doc.data();
                    const option = document.createElement('option');
                    option.value = sinif.ad;
                    option.textContent = sinif.ad;
                    sinifFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Sınıflar yüklenirken hata:', error);
            }
        }

        async function loadDersler(sinif) {
            try {
                const derslerSnapshot = await db.collection('dersler')
                    .where('sinifAdi', '==', sinif)
                    .get();

                const dersFilter = document.getElementById('ders-filter');
                dersFilter.innerHTML = '<option value="">Ders Seçin</option>';
                derslerSnapshot.forEach(doc => {
                    const ders = doc.data();
                    const option = document.createElement('option');
                    option.value = ders.ad;
                    option.textContent = ders.ad;
                    dersFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Dersler yüklenirken hata:', error);
            }
        }

        async function loadKonular(sinif, ders) {
            try {
                const konularSnapshot = await db.collection('konular')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .get();

                const konuFilter = document.getElementById('konu-filter');
                konuFilter.innerHTML = '<option value="">Konu Seçin</option>';
                konularSnapshot.forEach(doc => {
                    const konu = doc.data();
                    const option = document.createElement('option');
                    option.value = konu.ad;
                    option.textContent = konu.ad;
                    konuFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Konular yüklenirken hata:', error);
            }
        }

        async function loadFilteredTests(sinif, ders, konu) {
            try {
                const testlerSnapshot = await db.collection('testler')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .where('konuAdi', '==', konu)
                    .get();
                
                const tableBody = document.getElementById('test-table-body');
                tableBody.innerHTML = '';

                let totalTests = 0;
                let totalQuestions = 0;
                let activeTests = 0;

                testlerSnapshot.forEach(doc => {
                    const test = doc.data();
                    totalTests++;
                    totalQuestions += test.soruSayisi || 0;
                    if (test.aktif !== false) activeTests++;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="test-checkbox" value="${doc.id}" onchange="updateBulkDeleteButton()">
                        </td>
                        <td>${test.ad || test.testAdi || 'İsimsiz Test'}</td>
                        <td>${test.konuAdi || test.konu || 'Belirtilmemiş'}</td>
                        <td>${test.soruSayisi || 0}</td>
                        <td>${test.cozulmeSayisi || 0}</td>
                        <td>${test.ortalamaBasari || 0}%</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editTest('${doc.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTest('${doc.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                // İstatistikleri güncelle
                document.getElementById('total-tests').textContent = totalTests;
                document.getElementById('total-questions').textContent = totalQuestions;
                document.getElementById('active-tests').textContent = activeTests;

            } catch (error) {
                console.error('Filtrelenmiş testler yüklenirken hata:', error);
            }
        }

        async function loadTestHavuzlari() {
            try {
                const havuzlarSnapshot = await db.collection('test_havuzlari').get();
                
                const tableBody = document.getElementById('test-table-body');
                tableBody.innerHTML = '';

                let totalTests = 0;
                let totalQuestions = 0;
                let activeTests = 0;

                havuzlarSnapshot.forEach(doc => {
                    const havuz = doc.data();
                    if (havuz.testler && havuz.testler.length > 0) {
                        havuz.testler.forEach(test => {
                            totalTests++;
                            totalQuestions += test.soruSayisi || 0;
                            if (test.aktif !== false) activeTests++;

                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>
                                    <input type="checkbox" class="test-checkbox" value="${doc.id}" onchange="updateBulkDeleteButton()">
                                </td>
                                <td>${test.ad || test.testAdi || 'İsimsiz Test'} (Havuz: ${havuz.ad})</td>
                                <td>${test.konuAdi || test.konu || 'Belirtilmemiş'}</td>
                                <td>${test.soruSayisi || 0}</td>
                                <td>${test.cozulmeSayisi || 0}</td>
                                <td>${test.ortalamaBasari || 0}%</td>
                                <td><span class="badge badge-success">Aktif</span></td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${doc.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${doc.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                });

                // İstatistikleri güncelle
                document.getElementById('total-tests').textContent = totalTests;
                document.getElementById('total-questions').textContent = totalQuestions;
                document.getElementById('active-tests').textContent = activeTests;

            } catch (error) {
                console.error('Test havuzları yüklenirken hata:', error);
            }
        }

        // Sayfa yüklendiğinde Firebase'den verileri yükle
        document.addEventListener('DOMContentLoaded', loadDataFromFirebase);

        // Test yönetimi tabında filtreleri başlat
        document.addEventListener('DOMContentLoaded', function() {
            // Filtre event listener'ları
            const sinifFilter = document.getElementById('sinif-filter');
            const dersFilter = document.getElementById('ders-filter');
            const konuFilter = document.getElementById('konu-filter');
            const filterGo = document.getElementById('filter-go');

            if (sinifFilter) {
                sinifFilter.addEventListener('change', async () => {
                    const selectedSinif = sinifFilter.value;
                    if (selectedSinif) {
                        await loadDersler(selectedSinif);
                    }
                    dersFilter.innerHTML = '<option value="">Ders Seçin</option>';
                    konuFilter.innerHTML = '<option value="">Konu Seçin</option>';
                });
            }

            if (dersFilter) {
                dersFilter.addEventListener('change', async () => {
                    const selectedSinif = sinifFilter.value;
                    const selectedDers = dersFilter.value;
                    if (selectedSinif && selectedDers) {
                        await loadKonular(selectedSinif, selectedDers);
                    }
                    konuFilter.innerHTML = '<option value="">Konu Seçin</option>';
                });
            }

            if (filterGo) {
                filterGo.addEventListener('click', async () => {
                    const selectedSinif = sinifFilter.value;
                    const selectedDers = dersFilter.value;
                    const selectedKonu = konuFilter.value;
                    
                    if (selectedSinif && selectedDers && selectedKonu) {
                        await loadTests(selectedSinif, selectedDers, selectedKonu);
                    } else {
                        await loadTests(); // Tüm testleri yükle
                    }
                });
            }
        });

        // Sınıfları yükle
        async function loadSiniflar() {
            const sinifFilter = document.getElementById('sinif-filter');
            if (sinifFilter) {
                sinifFilter.innerHTML = `
                    <option value="">Sınıf Seçin</option>
                    <option value="1">1. Sınıf</option>
                    <option value="2">2. Sınıf</option>
                    <option value="3">3. Sınıf</option>
                    <option value="4">4. Sınıf</option>
                `;
            }
        }

        // Dersleri yükle
        async function loadDersler(sinif) {
            const dersFilter = document.getElementById('ders-filter');
            if (dersFilter) {
                const dersler = {
                    '1': ['Türkçe', 'Matematik', 'Hayat Bilgisi'],
                    '2': ['Türkçe', 'Matematik', 'Hayat Bilgisi'],
                    '3': ['Türkçe', 'Matematik', 'Hayat Bilgisi', 'Fen Bilimleri'],
                    '4': ['Türkçe', 'Matematik', 'Sosyal Bilgiler', 'Fen Bilimleri']
                };
                
                const sinifDersleri = dersler[sinif] || [];
                dersFilter.innerHTML = '<option value="">Ders Seçin</option>';
                sinifDersleri.forEach(ders => {
                    dersFilter.innerHTML += `<option value="${ders}">${ders}</option>`;
                });
            }
        }

        // Konuları yükle
        async function loadKonular(sinif, ders) {
            const konuFilter = document.getElementById('konu-filter');
            if (konuFilter) {
                // Basit konu listesi - gerçek uygulamada Firebase'den çekilebilir
                const konular = ['Genel', 'Temel Konular', 'İleri Seviye'];
                konuFilter.innerHTML = '<option value="">Konu Seçin</option>';
                konular.forEach(konu => {
                    konuFilter.innerHTML += `<option value="${konu}">${konu}</option>`;
                });
            }
        }

        // Test havuzlarını yükle
        async function loadTestHavuzlari() {
            try {
                const havuzlarSnapshot = await db.collection('test_havuzlari').get();
                const tableBody = document.getElementById('test-table-body');
                tableBody.innerHTML = '';

                havuzlarSnapshot.forEach(doc => {
                    const havuz = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="test-checkbox" value="${doc.id}" onchange="updateBulkDeleteButton()">
                        </td>
                        <td>${havuz.havuzAdi || 'İsimsiz Havuz'}</td>
                        <td>${havuz.konu || 'Belirtilmemiş'}</td>
                        <td>${havuz.testSayisi || 0}</td>
                        <td>0</td>
                        <td>0%</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editTest('${doc.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTest('${doc.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Test havuzları yüklenirken hata:', error);
                alert('Test havuzları yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Test Yönetimi JavaScript Fonksiyonları
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elementleri
            const sinifSelect = document.getElementById('sinif-select');
            const dersSelect = document.getElementById('ders-select');
            const konuSelect = document.getElementById('konu-select');
            const goBtn = document.getElementById('go-btn');
            const topicTitle = document.getElementById('topic-title');
            const pdfBtn = document.getElementById('pdf-btn');
            const excelBtn = document.getElementById('excel-btn');
            const havuzBtn = document.getElementById('havuz-btn');
            const testList = document.getElementById('test-list');
            const testListesi = document.getElementById('test-listesi');

            // Sınıf değiştiğinde dersleri yükle
            if (sinifSelect) {
                sinifSelect.addEventListener('change', async () => {
                    const selectedSinif = sinifSelect.value;
                    if (selectedSinif) {
                        await loadDersler(selectedSinif);
                    }
                    dersSelect.innerHTML = '<option value="">Ders Seçin</option>';
                    konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
                });
            }

            // Ders değiştiğinde konuları yükle
            if (dersSelect) {
                dersSelect.addEventListener('change', async () => {
                    const selectedDers = dersSelect.value;
                    if (selectedDers) {
                        await loadKonular(sinifSelect.value, selectedDers);
                    }
                    konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
                });
            }

            // Git butonuna tıklandığında
            if (goBtn) {
                goBtn.addEventListener('click', async () => {
                    const selectedSinif = sinifSelect.value;
                    const selectedDers = dersSelect.value;
                    const selectedKonu = konuSelect.value;

                    if (!selectedSinif || !selectedDers || !selectedKonu) {
                        alert('Lütfen sınıf, ders ve konu seçin!');
                        return;
                    }

                    await loadTests(selectedSinif, selectedDers, selectedKonu);
                });
            }

            // PDF butonuna tıklandığında
            if (pdfBtn) {
                pdfBtn.addEventListener('click', () => {
                    const selectedSinif = sinifSelect.value;
                    const selectedDers = dersSelect.value;
                    const selectedKonu = konuSelect.value;

                    if (!selectedSinif || !selectedDers || !selectedKonu) {
                        alert('Lütfen önce sınıf, ders ve konu seçin!');
                        return;
                    }

                    window.location.href = `pdf-test-yukle.html?sinifAdi=${encodeURIComponent(selectedSinif)}&dersAdi=${encodeURIComponent(selectedDers)}&konuAdi=${encodeURIComponent(selectedKonu)}`;
                });
            }

            // Excel butonuna tıklandığında
            if (excelBtn) {
                excelBtn.addEventListener('click', () => {
                    const selectedSinif = sinifSelect.value;
                    const selectedDers = dersSelect.value;
                    const selectedKonu = konuSelect.value;

                    if (!selectedSinif || !selectedDers || !selectedKonu) {
                        alert('Lütfen önce sınıf, ders ve konu seçin!');
                        return;
                    }

                    window.location.href = `toplu-test-yukle.html?sinifAdi=${encodeURIComponent(selectedSinif)}&dersAdi=${encodeURIComponent(selectedDers)}&konuAdi=${encodeURIComponent(selectedKonu)}`;
                });
            }

            // Havuz butonuna tıklandığında
            if (havuzBtn) {
                havuzBtn.addEventListener('click', () => {
                    alert('Test havuzu özelliği kaldırılmıştır.');
                });
            }
        });

        // Firebase'den sınıfları yükle
        async function loadSiniflar() {
            try {
                const siniflarSnapshot = await db.collection('siniflar').get();
                
                if (sinifSelect) {
                    sinifSelect.innerHTML = '<option value="">Sınıf Seçin</option>';
                    siniflarSnapshot.forEach(doc => {
                        const sinif = doc.data();
                        const option = document.createElement('option');
                        option.value = sinif.ad;
                        option.textContent = sinif.ad;
                        sinifSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Sınıflar yüklenirken hata:', error);
            }
        }

        // Firebase'den dersleri yükle
        async function loadDersler(sinif) {
            try {
                const derslerSnapshot = await db.collection('dersler')
                    .where('sinifAdi', '==', sinif)
                    .get();

                if (dersSelect) {
                    dersSelect.innerHTML = '<option value="">Ders Seçin</option>';
                    derslerSnapshot.forEach(doc => {
                        const ders = doc.data();
                        const option = document.createElement('option');
                        option.value = ders.ad;
                        option.textContent = ders.ad;
                        dersSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Dersler yüklenirken hata:', error);
            }
        }

        // Firebase'den konuları yükle
        async function loadKonular(sinif, ders) {
            try {
                const konularSnapshot = await db.collection('konular')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .get();

                if (konuSelect) {
                    konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
                    konularSnapshot.forEach(doc => {
                        const konu = doc.data();
                        const option = document.createElement('option');
                        option.value = konu.ad;
                        option.textContent = konu.ad;
                        konuSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Konular yüklenirken hata:', error);
            }
        }

        // Firebase'den testleri yükle
        async function loadTests(sinif, ders, konu) {
            try {
                const testlerSnapshot = await db.collection('testler')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .where('konuAdi', '==', konu)
                    .get();

                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({
                        _id: doc.id,
                        ...doc.data()
                    });
                });

                // Topic title'ı güncelle
                if (topicTitle) {
                    topicTitle.textContent = `${sinif} - ${ders} - ${konu}`;
                }

                // İstatistikleri güncelle
                if (document.getElementById('toplam-test')) {
                    document.getElementById('toplam-test').textContent = testler.length;
                }
                
                const toplamSoru = testler.reduce((total, test) => {
                    return total + (test.sorular ? test.sorular.length : 0);
                }, 0);
                
                if (document.getElementById('toplam-soru')) {
                    document.getElementById('toplam-soru').textContent = toplamSoru;
                }
                
                if (document.getElementById('aktif-test')) {
                    document.getElementById('aktif-test').textContent = testler.filter(t => t.aktif !== false).length;
                }

                // Test listesini güncelle
                const testListesi = document.getElementById('test-listesi');
                if (testListesi) {
                    testListesi.innerHTML = '';

                    if (testler.length > 0) {
                        testler.forEach(test => {
                            const testCard = document.createElement('div');
                            testCard.className = 'test-card';
                            testCard.innerHTML = `
                                <div class="test-info">
                                    <h3>${test.ad || test.testAdi || 'İsimsiz Test'}</h3>
                                    <p><strong>Konu:</strong> ${test.konuAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Soru Sayısı:</strong> ${test.sorular ? test.sorular.length : 0}</p>
                                    <p><strong>Durum:</strong> <span class="badge badge-success">Aktif</span></p>
                                </div>
                                <div class="test-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${test._id}')">
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${test._id}')">
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                </div>
                            `;
                            testListesi.appendChild(testCard);
                        });
                    } else {
                        testListesi.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h3>Bu konuda henüz test bulunmamaktadır</h3>
                                <p>PDF veya Excel dosyası yükleyerek testler ekleyebilirsiniz</p>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Testler yüklenirken hata:', error);
                alert('Testler yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Tüm testleri yükle
        async function loadAllTests() {
            try {
                const testlerSnapshot = await db.collection('testler').get();
                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({
                        _id: doc.id,
                        ...doc.data()
                    });
                });

                // Özet kartları güncelle
                updateSummaryCards();

                // Test listesini güncelle
                const testListesi = document.getElementById('test-listesi');
                if (testListesi) {
                    testListesi.innerHTML = '';

                    if (testler.length > 0) {
                        testler.forEach(test => {
                            const testCard = document.createElement('div');
                            testCard.className = 'test-card';
                            testCard.innerHTML = `
                                <div class="test-info">
                                    <h3>${test.ad || test.testAdi || 'İsimsiz Test'}</h3>
                                    <p><strong>Konu:</strong> ${test.konuAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Soru Sayısı:</strong> ${test.sorular ? test.sorular.length : 0}</p>
                                    <p><strong>Durum:</strong> <span class="badge badge-success">Aktif</span></p>
                                </div>
                                <div class="test-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${test._id}')">
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${test._id}')">
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                </div>
                            `;
                            testListesi.appendChild(testCard);
                        });
                    } else {
                        testListesi.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h3>Henüz test bulunmamaktadır</h3>
                                <p>Excel dosyası yükleyerek testler ekleyebilirsiniz</p>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Testler yüklenirken hata:', error);
                alert('Testler yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Özet kartları güncelle
        async function updateSummaryCards() {
            try {
                // Sınıf sayısı
                const siniflarSnapshot = await db.collection('siniflar').get();
                document.getElementById('sinif-sayisi').textContent = siniflarSnapshot.size;

                // Ders sayısı
                const derslerSnapshot = await db.collection('dersler').get();
                document.getElementById('ders-sayisi').textContent = derslerSnapshot.size;

                // Konu sayısı
                const konularSnapshot = await db.collection('konular').get();
                document.getElementById('konu-sayisi').textContent = konularSnapshot.size;

                // Test sayısı
                const testlerSnapshot = await db.collection('testler').get();
                document.getElementById('test-sayisi').textContent = testlerSnapshot.size;

                // Hikaye sayısı
                const hikayelerSnapshot = await db.collection('hikayeler').get();
                document.getElementById('hikaye-sayisi').textContent = hikayelerSnapshot.size;

            } catch (error) {
                console.error('Özet kartları güncellenirken hata:', error);
            }
        }

        // Toplu silme butonunu güncelle
        function updateBulkDeleteButton() {
            const checkboxes = document.querySelectorAll('.test-checkbox:checked');
            const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
            
            if (bulkDeleteBtn) {
                if (checkboxes.length > 0) {
                    bulkDeleteBtn.style.display = 'inline-block';
                } else {
                    bulkDeleteBtn.style.display = 'none';
                }
            }
        }

        // Toplu test silme
        async function bulkDeleteTests() {
            const checkboxes = document.querySelectorAll('.test-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('Lütfen silinecek testleri seçin!');
                return;
            }

            if (confirm(`${checkboxes.length} testi silmek istediğinizden emin misiniz?`)) {
                try {
                    for (let checkbox of checkboxes) {
                        await db.collection('testler').doc(checkbox.value).delete();
                    }
                    alert('Seçili testler başarıyla silindi!');
                    loadAllTests(); // Testleri yeniden yükle
                } catch (error) {
                    console.error('Testler silinirken hata:', error);
                    alert('Testler silinirken hata oluştu: ' + error.message);
                }
            }
        }

        // Sınıf sekmesi göster
        function showClassTab(sinifId) {
            // Tüm sınıf sekmelerini pasif yap
            const classTabs = document.querySelectorAll('.class-tab');
            classTabs.forEach(tab => tab.classList.remove('active'));

            // Tüm sınıf içeriklerini gizle
            const classContents = document.querySelectorAll('.class-tab-content');
            classContents.forEach(content => content.classList.remove('active'));

            // Seçilen sınıf sekmesini aktif yap
            const selectedTab = document.querySelector(`[onclick="showClassTab('${sinifId}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Seçilen sınıf içeriğini göster
            const selectedContent = document.getElementById(`${sinifId}-content`);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
        }

        // Ders içeriğini göster
        function showDersContent(sinifId, dersAdi) {
            // Sınıf numarasını al
            const sinifNumarasi = sinifId.replace('sinif', '');
            
            // Ders detay sayfasına yönlendir
            window.location.href = `ders-detay.html?sinif=${sinifNumarasi}.%20Sınıf&ders=${encodeURIComponent(dersAdi)}`;
        }

        // Test Yönetim Paneli Fonksiyonları (test-yonetim.html'den)
        
        // DOM elementleri
        const sinifSelect = document.getElementById('sinif-select');
        const dersSelect = document.getElementById('ders-select');
        const konuSelect = document.getElementById('konu-select');
        const goBtn = document.getElementById('go-btn');
        const topicTitle = document.getElementById('topic-title');
        const pdfBtn = document.getElementById('pdf-btn');
        const excelBtn = document.getElementById('excel-btn');
        const havuzBtn = document.getElementById('havuz-btn');

        // Event listener'ları ekle
        if (sinifSelect) {
            sinifSelect.addEventListener('change', async () => {
                const selectedSinif = sinifSelect.value;
                if (selectedSinif) {
                    await loadDersler(selectedSinif);
                }
                dersSelect.innerHTML = '<option value="">Ders Seçin</option>';
                konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
            });
        }

        if (dersSelect) {
            dersSelect.addEventListener('change', async () => {
                const selectedDers = dersSelect.value;
                if (selectedDers) {
                    await loadKonular(sinifSelect.value, selectedDers);
                }
                konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
            });
        }

        if (goBtn) {
            goBtn.addEventListener('click', async () => {
                const selectedSinif = sinifSelect.value;
                const selectedDers = dersSelect.value;
                const selectedKonu = konuSelect.value;

                if (!selectedSinif || !selectedDers || !selectedKonu) {
                    alert('Lütfen sınıf, ders ve konu seçin!');
                    return;
                }

                await loadTests(selectedSinif, selectedDers, selectedKonu);
            });
        }

        if (pdfBtn) {
            pdfBtn.addEventListener('click', () => {
                const selectedSinif = sinifSelect.value;
                const selectedDers = dersSelect.value;
                const selectedKonu = konuSelect.value;

                if (!selectedSinif || !selectedDers || !selectedKonu) {
                    alert('Lütfen önce sınıf, ders ve konu seçin!');
                    return;
                }

                window.location.href = `pdf-test-yukle.html?sinifAdi=${encodeURIComponent(selectedSinif)}&dersAdi=${encodeURIComponent(selectedDers)}&konuAdi=${encodeURIComponent(selectedKonu)}`;
            });
        }

        if (excelBtn) {
            excelBtn.addEventListener('click', () => {
                const selectedSinif = sinifSelect.value;
                const selectedDers = dersSelect.value;
                const selectedKonu = konuSelect.value;

                if (!selectedSinif || !selectedDers || !selectedKonu) {
                    alert('Lütfen önce sınıf, ders ve konu seçin!');
                    return;
                }

                window.location.href = `toplu-test-yukle.html?sinifAdi=${encodeURIComponent(selectedSinif)}&dersAdi=${encodeURIComponent(selectedDers)}&konuAdi=${encodeURIComponent(selectedKonu)}`;
            });
        }

        if (havuzBtn) {
            havuzBtn.addEventListener('click', () => {
                alert('Test havuzu özelliği kaldırılmıştır.');
            });
        }

        // Firebase'den sınıfları yükle
        async function loadSiniflar() {
            try {
                const siniflarSnapshot = await db.collection('siniflar').get();
                
                if (sinifSelect) {
                    sinifSelect.innerHTML = '<option value="">Sınıf Seçin</option>';
                    siniflarSnapshot.forEach(doc => {
                        const sinif = doc.data();
                        const option = document.createElement('option');
                        option.value = sinif.ad;
                        option.textContent = sinif.ad;
                        sinifSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Sınıflar yüklenirken hata:', error);
            }
        }

        // Firebase'den dersleri yükle
        async function loadDersler(sinif) {
            try {
                const derslerSnapshot = await db.collection('dersler')
                    .where('sinifAdi', '==', sinif)
                    .get();

                if (dersSelect) {
                    dersSelect.innerHTML = '<option value="">Ders Seçin</option>';
                    derslerSnapshot.forEach(doc => {
                        const ders = doc.data();
                        const option = document.createElement('option');
                        option.value = ders.ad;
                        option.textContent = ders.ad;
                        dersSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Dersler yüklenirken hata:', error);
            }
        }

        // Firebase'den konuları yükle
        async function loadKonular(sinif, ders) {
            try {
                const konularSnapshot = await db.collection('konular')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .get();

                if (konuSelect) {
                    konuSelect.innerHTML = '<option value="">Konu Seçin</option>';
                    konularSnapshot.forEach(doc => {
                        const konu = doc.data();
                        const option = document.createElement('option');
                        option.value = konu.ad;
                        option.textContent = konu.ad;
                        konuSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Konular yüklenirken hata:', error);
            }
        }

        // Firebase'den testleri yükle
        async function loadTests(sinif, ders, konu) {
            try {
                const testlerSnapshot = await db.collection('testler')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .where('konuAdi', '==', konu)
                    .get();

                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({
                        _id: doc.id,
                        ...doc.data()
                    });
                });

                // Topic title'ı güncelle
                if (topicTitle) {
                    topicTitle.textContent = `${sinif} - ${ders} - ${konu}`;
                }

                // İstatistikleri güncelle
                if (document.getElementById('toplam-test')) {
                    document.getElementById('toplam-test').textContent = testler.length;
                }
                
                const toplamSoru = testler.reduce((total, test) => {
                    return total + (test.sorular ? test.sorular.length : 0);
                }, 0);
                
                if (document.getElementById('toplam-soru')) {
                    document.getElementById('toplam-soru').textContent = toplamSoru;
                }
                
                if (document.getElementById('aktif-test')) {
                    document.getElementById('aktif-test').textContent = testler.filter(t => t.aktif !== false).length;
                }

                // Test listesini güncelle
                const testListesi = document.getElementById('test-listesi');
                if (testListesi) {
                    testListesi.innerHTML = '';

                    if (testler.length > 0) {
                        testler.forEach(test => {
                            const testCard = document.createElement('div');
                            testCard.className = 'test-card';
                            testCard.innerHTML = `
                                <div class="test-info">
                                    <h3>${test.ad || test.testAdi || 'İsimsiz Test'}</h3>
                                    <p><strong>Konu:</strong> ${test.konuAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Soru Sayısı:</strong> ${test.sorular ? test.sorular.length : 0}</p>
                                    <p><strong>Durum:</strong> <span class="badge badge-success">Aktif</span></p>
                                </div>
                                <div class="test-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${test._id}')">
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${test._id}')">
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                </div>
                            `;
                            testListesi.appendChild(testCard);
                        });
                    } else {
                        testListesi.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h3>Bu konuda henüz test bulunmamaktadır</h3>
                                <p>PDF veya Excel dosyası yükleyerek testler ekleyebilirsiniz</p>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Testler yüklenirken hata:', error);
                alert('Testler yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Breadcrumb Navigasyon Fonksiyonları (yonetim.html'den)
        let currentStep = 'ana';
        let selectedSinif = '';
        let selectedDers = '';
        let selectedKonu = '';

        // Breadcrumb adımını göster
        async function showBreadcrumbStep(step) {
            // Tüm içerikleri gizle
            document.querySelectorAll('.breadcrumb-content').forEach(content => {
                content.style.display = 'none';
            });

            // Breadcrumb'ı güncelle
            updateBreadcrumb(step);

            // İlgili içeriği göster
            switch (step) {
                case 'ana':
                    document.getElementById('sinif-content').style.display = 'block';
                    await loadSinifButtons();
                    break;
                case 'sinif':
                    document.getElementById('sinif-content').style.display = 'block';
                    await loadSinifButtons();
                    break;
                case 'ders':
                    if (selectedSinif) {
                        document.getElementById('ders-content').style.display = 'block';
                        document.getElementById('selected-sinif').textContent = selectedSinif;
                        await loadDersButtons(selectedSinif);
                    } else {
                        showBreadcrumbStep('sinif');
                    }
                    break;
                case 'konu':
                    if (selectedDers) {
                        document.getElementById('konu-content').style.display = 'block';
                        document.getElementById('selected-ders').textContent = selectedDers;
                        await loadKonuButtons(selectedSinif, selectedDers);
                    } else {
                        showBreadcrumbStep('ders');
                    }
                    break;
                case 'test':
                    if (selectedKonu) {
                        document.getElementById('test-content').style.display = 'block';
                        document.getElementById('selected-konu').textContent = selectedKonu;
                        await loadTestList(selectedSinif, selectedDers, selectedKonu);
                    } else {
                        showBreadcrumbStep('konu');
                    }
                    break;
            }

            currentStep = step;
        }

        // Breadcrumb'ı güncelle
        function updateBreadcrumb(step) {
            // Tüm breadcrumb linklerini gizle
            document.getElementById('breadcrumb-ders').style.display = 'none';
            document.getElementById('breadcrumb-ders-arrow').style.display = 'none';
            document.getElementById('breadcrumb-konu').style.display = 'none';
            document.getElementById('breadcrumb-konu-arrow').style.display = 'none';
            document.getElementById('breadcrumb-test').style.display = 'none';

            // Adıma göre breadcrumb'ı güncelle
            switch (step) {
                case 'ana':
                    break;
                case 'sinif':
                    break;
                case 'ders':
                    document.getElementById('breadcrumb-ders').style.display = 'inline';
                    document.getElementById('breadcrumb-ders-arrow').style.display = 'inline';
                    break;
                case 'konu':
                    document.getElementById('breadcrumb-ders').style.display = 'inline';
                    document.getElementById('breadcrumb-ders-arrow').style.display = 'inline';
                    document.getElementById('breadcrumb-konu').style.display = 'inline';
                    document.getElementById('breadcrumb-konu-arrow').style.display = 'inline';
                    break;
                case 'test':
                    document.getElementById('breadcrumb-ders').style.display = 'inline';
                    document.getElementById('breadcrumb-ders-arrow').style.display = 'inline';
                    document.getElementById('breadcrumb-konu').style.display = 'inline';
                    document.getElementById('breadcrumb-konu-arrow').style.display = 'inline';
                    document.getElementById('breadcrumb-test').style.display = 'inline';
                    break;
            }
        }

        // Sınıf butonlarını yükle
        async function loadSinifButtons() {
            try {
                const siniflarSnapshot = await db.collection('siniflar').get();
                const sinifButtons = document.getElementById('sinif-buttons');
                
                sinifButtons.innerHTML = '';
                siniflarSnapshot.forEach(doc => {
                    const sinif = doc.data();
                    const button = document.createElement('button');
                    button.className = 'btn-custom btn-sinif';
                    
                    // Sınıf için renk ve ikon seç
                    const sinifStyle = getSinifStyle(sinif.ad);
                    
                    button.style.background = sinifStyle.gradient;
                    button.innerHTML = `<i class="fas fa-child" style="color: ${sinifStyle.iconColor}"></i> ${sinif.ad}`;
                    button.onclick = () => {
                        // Yeni sayfaya git
                        window.location.href = `sinif-detay.html?sinif=${encodeURIComponent(sinif.ad)}`;
                    };
                    sinifButtons.appendChild(button);
                });
            } catch (error) {
                console.error('Sınıflar yüklenirken hata:', error);
            }
        }

        // Sınıf için stil seç
        function getSinifStyle(sinifAdi) {
            const sinifStyles = {
                '1. Sınıf': {
                    gradient: 'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',
                    iconColor: '#fff'
                },
                '2. Sınıf': {
                    gradient: 'linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%)',
                    iconColor: '#fff'
                },
                '3. Sınıf': {
                    gradient: 'linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%)',
                    iconColor: '#fff'
                },
                '4. Sınıf': {
                    gradient: 'linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%)',
                    iconColor: '#fff'
                },
                '5. Sınıf': {
                    gradient: 'linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%)',
                    iconColor: '#fff'
                },
                '6. Sınıf': {
                    gradient: 'linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%)',
                    iconColor: '#fff'
                },
                '7. Sınıf': {
                    gradient: 'linear-gradient(135deg, #00b894 0%, #00cec9 100%)',
                    iconColor: '#fff'
                },
                '8. Sınıf': {
                    gradient: 'linear-gradient(135deg, #e17055 0%, #d63031 100%)',
                    iconColor: '#fff'
                }
            };
            
            return sinifStyles[sinifAdi] || {
                gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                iconColor: '#fff'
            };
        }

        // Ders butonlarını yükle
        async function loadDersButtons(sinif) {
            try {
                const derslerSnapshot = await db.collection('dersler')
                    .where('sinifAdi', '==', sinif)
                    .get();
                
                const dersButtons = document.getElementById('ders-buttons');
                dersButtons.innerHTML = '';
                
                derslerSnapshot.forEach(doc => {
                    const ders = doc.data();
                    const button = document.createElement('button');
                    button.className = 'btn-custom btn-ders';
                    button.innerHTML = `<i class="fas fa-book"></i> ${ders.ad}`;
                    button.onclick = () => {
                        selectedDers = ders.ad;
                        showBreadcrumbStep('konu');
                    };
                    dersButtons.appendChild(button);
                });
            } catch (error) {
                console.error('Dersler yüklenirken hata:', error);
            }
        }

        // Konu butonlarını yükle
        async function loadKonuButtons(sinif, ders) {
            try {
                const konularSnapshot = await db.collection('konular')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .get();
                
                const konuButtons = document.getElementById('konu-buttons');
                konuButtons.innerHTML = '';
                
                konularSnapshot.forEach(doc => {
                    const konu = doc.data();
                    const button = document.createElement('button');
                    button.className = 'btn-custom btn-konu';
                    button.innerHTML = `<i class="fas fa-list"></i> ${konu.ad}`;
                    button.onclick = () => {
                        selectedKonu = konu.ad;
                        showBreadcrumbStep('test');
                    };
                    konuButtons.appendChild(button);
                });
            } catch (error) {
                console.error('Konular yüklenirken hata:', error);
            }
        }

        // Test listesini yükle
        async function loadTestList(sinif, ders, konu) {
            try {
                const testlerSnapshot = await db.collection('testler')
                    .where('sinifAdi', '==', sinif)
                    .where('dersAdi', '==', ders)
                    .where('konuAdi', '==', konu)
                    .get();

                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({
                        _id: doc.id,
                        ...doc.data()
                    });
                });

                const testListesi = document.getElementById('test-listesi');
                if (testListesi) {
                    testListesi.innerHTML = '';

                    if (testler.length > 0) {
                        testler.forEach(test => {
                            const testCard = document.createElement('div');
                            testCard.className = 'test-card';
                            testCard.innerHTML = `
                                <div class="test-info">
                                    <h3>${test.ad || test.testAdi || 'İsimsiz Test'}</h3>
                                    <p><strong>Konu:</strong> ${test.konuAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Soru Sayısı:</strong> ${test.sorular ? test.sorular.length : 0}</p>
                                    <p><strong>Durum:</strong> <span class="badge badge-success">Aktif</span></p>
                                </div>
                                <div class="test-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${test._id}')">
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${test._id}')">
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                </div>
                            `;
                            testListesi.appendChild(testCard);
                        });
                    } else {
                        testListesi.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h3>Bu konuda henüz test bulunmamaktadır</h3>
                                <p>PDF veya Excel dosyası yükleyerek testler ekleyebilirsiniz</p>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Testler yüklenirken hata:', error);
                alert('Testler yüklenirken hata oluştu: ' + error.message);
            }
        }

        // Genel test listesini yükle (tüm testler)
        async function loadGeneralTestList() {
            try {
                const testlerSnapshot = await db.collection('testler').get();
                const testler = [];
                testlerSnapshot.forEach(doc => {
                    testler.push({
                        _id: doc.id,
                        ...doc.data()
                    });
                });

                const generalTestListesi = document.getElementById('general-test-listesi');
                if (generalTestListesi) {
                    generalTestListesi.innerHTML = '';

                    if (testler.length > 0) {
                        testler.forEach(test => {
                            const testCard = document.createElement('div');
                            testCard.className = 'test-card';
                            testCard.innerHTML = `
                                <div class="test-checkbox">
                                    <input type="checkbox" class="test-checkbox" value="${test._id}" onchange="updateBulkDeleteButton()">
                                </div>
                                <div class="test-info">
                                    <h3>${test.ad || test.testAdi || 'İsimsiz Test'}</h3>
                                    <p><strong>Sınıf:</strong> ${test.sinifAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Ders:</strong> ${test.dersAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Konu:</strong> ${test.konuAdi || 'Belirtilmemiş'}</p>
                                    <p><strong>Soru Sayısı:</strong> ${test.sorular ? test.sorular.length : 0}</p>
                                    <p><strong>Durum:</strong> <span class="badge badge-success">Aktif</span></p>
                                </div>
                                <div class="test-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editTest('${test._id}')">
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteTest('${test._id}')">
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                </div>
                            `;
                            generalTestListesi.appendChild(testCard);
                        });
                    } else {
                        generalTestListesi.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h3>Henüz test bulunmamaktadır</h3>
                                <p>PDF veya Excel dosyası yükleyerek testler ekleyebilirsiniz</p>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Genel testler yüklenirken hata:', error);
                alert('Genel testler yüklenirken hata oluştu: ' + error.message);
            }
        }
    </script>
</body>
</html> 